// JavaScript Documentwindow.addEventListener('load',function(){	var oHeader=document.querySelector('header');	var oBlank=document.querySelector('.blank');	var oNav=document.querySelector('.nav');	var oPhoto=document.querySelector('.photo');	var oWeb=document.getElementById('web');		var oBox=document.querySelector('.page2 .box');//3D环的母盒子	var aLi=oBox.querySelectorAll('li');//3D环的每个片	var aSkill=document.querySelectorAll('.page2 .box b');	var aPaper=document.querySelectorAll('.paper')	var aDis=[];//page4的位移变量		var aBox=document.querySelectorAll('.work li');//page4作业盒子	var flag='';	var len=aBox.length;		oWeb.style.WebkitAnimation='web 2s forwards';	//page之间的切换效果	(function(){		var aPos=[];		var aPage=document.getElementsByClassName('page');		var oCon=document.querySelector('.con');		var aBtn=document.querySelectorAll('.nav>li');		var aAside=document.querySelectorAll('.aside>li');		var len=aPage.length;		var inow=0;		var bOk=true;				//保存每个page的位置		for(var i=0;i<aPage.length;i++){			aPos.push(getPos(aPage[i]).top);		}				//给window绑定滚轮事件 改变inow,然后切换page		wheel(window,function(bDir){			if(!bOk)return;			bOk=false;			if(bDir){//向下				inow++;				if(inow>len-1){					inow=len-1;				}			}else{				inow--;				if(inow<0){					inow=0;				}			};			tab();					});				//給顶部btn绑定点击切换page事件		for(var i=0;i<len;i++){			(function(index){				addEvent(aBtn[i],'click',function(){						if(!bOk)return;					bOk=false;					inow=index;					tab();							});			})(i);					}				//给侧边栏绑定点击切换page事件		for(var i=0;i<len;i++){			(function(index){				addEvent(aAside[i],'click',function(){						if(!bOk)return;					bOk=false;					inow=index;					tab();							});			})(i);					}				//tab切换page函数		function tab(){			var iTarget=aPos[inow];			scrollMove(iTarget,800,function(){				bOk=true;			});			for(var i=0;i<len;i++){				aAside[i].classList.remove('inow');			}			aAside[inow].classList.add('inow');				rotate(inow);			page4(inow);			setTimeout(function(){				flyIn(inow);			},500);				}					})();			//page2的自动旋转效果函数	function rotate(inow){			clearTimeout(oBox.timer);			var len=aLi.length;		var d=360/len;			if(inow==1){							for(var i=0;i<len;i++){				(function(index){					aLi[index].style.WebkitTransition='1s all ease ';					oBox.timer=setTimeout(function(){						aLi[index].style.WebkitTransform='rotateY('+d*index+'deg) translateZ(300px) rotateX(-10deg)';						aSkill[index].style.WebkitAnimation='1.5s height linear forwards';					},500*(len-index));				})(i);			}					}else{			oBox.timer=setTimeout(function(){				for(var i=0;i<len;i++){								aLi[i].style.WebkitTransition='none';					aLi[i].style.WebkitTransform='rotateY(0) translateZ(0) rotateX(0)';					aSkill[i].style.WebkitAnimation='0.2s short linear forwards';				}				},100);			}								};		//page2的手动拖拽函数	(function(){		//待写....					})();			//page3的自动进入函数	function flyIn(inow){		if(inow==2){			for(var i=0;i<aPaper.length;i++){				aPaper[i].style.WebkitTransition='1s all linear';			}			aPaper[0].style.WebkitTransform='translateX(0) scale(0.9)';			aPaper[1].style.WebkitTransform='translateY(0) scale(1)';			aPaper[2].style.WebkitTransform='translateX(0) scale(0.9)';				}else{			for(var i=0;i<aPaper.length;i++){				aPaper[i].style.WebkitTransition='.1s all linear';			}			aPaper[0].style.WebkitTransform='translateX(-500px) scale(1)';			aPaper[1].style.WebkitTransform='translateY(500px) scale(1)';			aPaper[2].style.WebkitTransform='translateX(500px) scale(1)';		}			}			//page4的发作业效果	//合拢		function fold(){						for(var i=0;i<len;i++){				(function(index){					setTimeout(function(){						aBox[index].style.WebkitTransform='perspective(800px) translate('+aDis[index].X+'px,'+aDis[index].Y+'px) scale(0.1)';													},index*100);															})(i);			}		}						//散开		function oPen(){			//还要换资料			flag='open';			for(var i=0;i<len;i++){				(function(index){					setTimeout(function(){						aBox[index].style.WebkitTransform='perspective(800px) translate(0,0) scale(1)';													},(len-index)*100);															})(i);			}		}		function page4(inow){			if(inow==3){				oPen();			}else{								fold();			}		}			(function(){		var oP4=document.querySelector('.page4');		var oWork=oP4.querySelector('.work');		var oPrev=oP4.querySelector('.prev');		var oNext=oP4.querySelector('.next');		var bOk=false;					var X=oWork.offsetWidth/2;		var Y=oWork.offsetHeight/2;		var W=aBox[0].offsetWidth/2;						//储存位移距离		for(var i=0;i<len;i++){			aDis.push({X:X-aBox[i].offsetLeft-W,Y:Y-aBox[i].offsetTop+W});		}				for(var i=0;i<len;i++){						for(var i=0;i<len;i++){				aBox[i].style.WebkitTransform='perspective(800px) translate('+aDis[i].X+'px,'+aDis[i].Y+'px) scale(0.1)';			}										}									function show(){						if(!bOk)return;				bOk=false;						fold();			setTimeout(oPen,len*150);		}				//第一个盒子散开到位时  开关打开		aBox[0].addEventListener('transitionend',function(){			if(flag=='open'){				bOk=true							};		},false);				//最后一个盒子合拢时  切换数据		aBox[len-1].addEventListener('transitionend',function(){			if(flag=='fold'){				//调用open				alert('切换数据');							};		},false)						oNext.onclick=show;		//oNext.onclick=fold;			})();							(function(){					})();			},false);